ALTER PROC SP_ACTUALIZAR_CARDEX_SUCURSAL
AS
BEGIN

DECLARE @COMPARADOR INT
DECLARE @INICIO INT
DECLARE @FIN INT
DECLARE @CODIGO_PRODUCTO VARCHAR(500)
DECLARE @NOMBRE_PRODUCTO VARCHAR(500)
DECLARE @FECHA_CREACION DATETIME
DECLARE @ID_SUCURSAL INT

--SET @INICIO = (SELECT TOP 1 (ID_PRODUCTO) FROM TB_PRODUCTO ORDER BY ID_PRODUCTO ASC)

SET @INICIO = 440
SET @FIN = (SELECT TOP 1 (ID_PRODUCTO) FROM TB_PRODUCTO ORDER BY ID_PRODUCTO DESC)





WHILE @INICIO <= @FIN
BEGIN

	SET @CODIGO_PRODUCTO = (SELECT CODIGO_BARRAS FROM TB_PRODUCTO WHERE ID_PRODUCTO = @INICIO)
	SET @NOMBRE_PRODUCTO = (SELECT NOMBRE_PRODUCTO FROM TB_PRODUCTO WHERE ID_PRODUCTO = @INICIO)
	SET @FECHA_CREACION = (SELECT FECHA_CREACION FROM TB_PRODUCTO WHERE ID_PRODUCTO = @INICIO)
	SET @ID_SUCURSAL = (SELECT ID_SUCURSAL FROM TB_PRODUCTO WHERE ID_PRODUCTO = @INICIO)

		  IF NOT EXISTS (SELECT 1 FROM TB_CARDEX_SUCURSAL WHERE ID_PRODUCTO = @INICIO)
			BEGIN
            
				INSERT INTO TB_CARDEX_SUCURSAL
					(ID_PRODUCTO, CODIGO_PRODUCTO, NOMBRE_PRODUCTO, CANTIDAD_ANTERIOR, CANTIDAD_ACTUAL, CANTIDAD_MOVIMIENTO, MOVIMIENTO, FECHA_CREACION_MOVIMIENTO, ESTADO, FECHA_CREACION, ID_SUCURSAL, ID_SUCURSAL_MOVIMIENTO, ID_USUARIO, NOMBRE_SUCURSAL)
				VALUES
					(@INICIO,@CODIGO_PRODUCTO,@NOMBRE_PRODUCTO,0,0,0,'CREACION',GETDATE(),1,@FECHA_CREACION,1,@ID_SUCURSAL,1,'SUCURSAL')

				INSERT INTO TB_CARDEX_SUCURSAL
					(ID_PRODUCTO, CODIGO_PRODUCTO, NOMBRE_PRODUCTO, CANTIDAD_ANTERIOR, CANTIDAD_ACTUAL, CANTIDAD_MOVIMIENTO, MOVIMIENTO, FECHA_CREACION_MOVIMIENTO, ESTADO, FECHA_CREACION, ID_SUCURSAL, ID_SUCURSAL_MOVIMIENTO, ID_USUARIO, NOMBRE_SUCURSAL)
				VALUES
					(@INICIO,@CODIGO_PRODUCTO,@NOMBRE_PRODUCTO,0,0,0,'CREACION',GETDATE(),1,@FECHA_CREACION,2,@ID_SUCURSAL,1,'COMPUFACIL')
			END
SET @INICIO = @INICIO +1
END


END


